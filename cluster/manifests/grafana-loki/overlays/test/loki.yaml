apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: grafana-loki-stack
  namespace: loki
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: deployments
  destination:
    server: https://kubernetes.default.svc
    namespace: loki
  source:
    chart: grafana-loki
    repoURL: https://github.com/CuriBio/k8s_curi.git
    targetRevision: HEAD
    path: applications/overlays/test
    helm:
      releaseName: grafana-loki
      # values: values-test.yaml
    # helm:
      values: |
        loki:
          auth_enabled: false
          commonConfig:
            path_prefix: /var/loki
            replication_factor: 1
          storage:
            bucketNames:
              chunks: loki-logs
            type: s3
          schema_config:
            configs:
              - from: "2022-01-11"
                index:
                  period: 24h
                  prefix: loki_index_
                store: boltdb-shipper
                object_store: s3
                schema: v12

          storage_config:
            aws:
              s3: test-loki-logs
              insecure: false
              s3forcepathstyle: true
            boltdb_shipper:
              active_index_directory: /var/loki/index
              shared_store: s3
          rulerConfig:
            storage:
              type: local
              local:
                directory: /var/loki/rules
        serviceAccount:
          create: true
          
        write:
          replicas: 2

        read:
          replicas: 1
        test:
          enabled: false
        monitoring:
          dashboards:
            enabled: false
          rules:
            enabled: false
          alerts:
            enabled: false
          serviceMonitor:
            enabled: false
          selfMonitoring:
            enabled: false
            lokiCanary:
              enabled: false
            grafanaAgent:
              installOperator: false
